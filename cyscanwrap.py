
import numpy as np
import pyximport
pyximport.install(setup_args={'include_dirs':[np.get_include()]})
from supra.Supracenter.cyscan2 import cyscan
from supra.Supracenter.anglescan import anglescan
from supra.Supracenter.cyzInteg import zInteg


z_profile = np.array(
[[  1.09800000e+03,   3.33249621e+02,   6.39769967e+00,   8.15753052e-01],
 [  1.32870000e+03,   3.32245814e+02,   7.46880547e+00,   8.21841037e-01],
 [  1.45991000e+03,   3.31259057e+02,   7.75688260e+00,   8.19828570e-01],
 [  1.75063000e+03,   3.30386460e+02,   8.42901661e+00,   8.28831141e-01],
 [  2.08109000e+03,   3.29449692e+02,   8.86068035e+00,   8.06714981e-01],
 [  2.26180000e+03,   3.28453268e+02,   8.97530606e+00,   7.34630784e-01],
 [  2.65469000e+03,   3.27410620e+02,   9.00045710e+00,   6.62316170e-01],
 [  3.08925000e+03,   3.25090182e+02,   8.78484173e+00,   5.17458770e-01],
 [  3.81482000e+03,   3.22613843e+02,   9.23816624e+00,   4.71988932e-01],
 [  4.34173000e+03,   3.19867468e+02,   1.02598161e+01,   4.81650572e-01],
 [  4.89602000e+03,   3.16732426e+02,   1.13200487e+01,   4.82942404e-01],
 [  5.75930000e+03,   3.13210326e+02,   1.17077738e+01,   5.04343430e-01],
 [  6.31500000e+03,   3.13210326e+02,   1.17077738e+01,   5.04343430e-01],
 [  6.63166000e+03,   3.09223385e+02,   1.23709315e+01,   5.72768257e-01],
 [  7.21409000e+03,   3.04648244e+02,   1.19807062e+01,   5.62036780e-01],
 [  8.38036000e+03,   2.99650957e+02,   1.19626229e+01,   3.42363272e-01],
 [  9.25570000e+03,   2.96384905e+02,   1.34617191e+01,   4.15566865e-01],
 [  1.04226400e+04,   2.97597801e+02,   1.72666631e+01,   6.36915559e-01],
 [  1.12979300e+04,   2.98152179e+02,   1.85458983e+01,   8.13275332e-01],
 [  1.15320000e+04,   2.98152179e+02,   1.85458983e+01,   8.13275332e-01],
 [  1.18902400e+04,   2.98841966e+02,   1.63087678e+01,   9.13307592e-01],
 [  1.27973000e+04,   2.99356526e+02,   1.61640549e+01,   8.97905113e-01],
 [  1.37271800e+04,   2.99292602e+02,   1.68634748e+01,   9.74438712e-01],
 [  1.50035000e+04,   2.98562063e+02,   1.65094500e+01,   1.08703972e+00],
 [  1.63228300e+04,   2.96805638e+02,   1.48915123e+01,   1.39067664e+00],
 [  1.67490000e+04,   2.96727136e+02,   1.51893465e+01,   1.39105321e+00],
 [  1.87563400e+04,   2.94340057e+02,   1.16511671e+01,   1.33977629e+00],
 [  2.06949000e+04,   2.93534851e+02,   1.68547503e+01,   1.62653654e+00],
 [  2.19660000e+04,   2.93534851e+02,   1.68547503e+01,   1.62653654e+00],
 [  2.39000200e+04,   2.90542342e+02,   1.85821413e+01,   1.74761806e+00],
 [  2.66355600e+04,   2.90029354e+02,   3.13705767e+01,   1.47533555e+00],
 [  2.71830000e+04,   2.90029354e+02,   3.13705767e+01,   1.47533555e+00],
 [  3.13309600e+04,   2.96627600e+02,   4.80634166e+01,   1.57133120e+00],
 [  3.24000000e+04,   2.96627600e+02,   4.80634166e+01,   1.57133120e+00]])
# z_profile = np.array(
# [[  1.09800000e+03,   3.33249621e+02,   0.0, 0.0],
#  [  1.32870000e+03,   3.32245814e+02,   0.0, 0.0],
#  [  1.45991000e+03,   3.31259057e+02,   0.0, 0.0],
#  [  1.75063000e+03,   3.30386460e+02,   0.0, 0.0],
#  [  2.08109000e+03,   3.29449692e+02,   0.0, 0.0],
#  [  2.26180000e+03,   3.28453268e+02,   0.0, 0.0],
#  [  2.65469000e+03,   3.27410620e+02,   0.0, 0.0],
#  [  3.08925000e+03,   3.25090182e+02,   0.0, 0.0],
#  [  3.81482000e+03,   3.22613843e+02,   0.0, 0.0],
#  [  4.34173000e+03,   3.19867468e+02,   0.0, 0.0],
#  [  4.89602000e+03,   3.16732426e+02,   0.0, 0.0],
#  [  5.75930000e+03,   3.13210326e+02,   0.0, 0.0],
#  [  6.31500000e+03,   3.13210326e+02,   0.0, 0.0],
#  [  6.63166000e+03,   3.09223385e+02,   0.0, 0.0],
#  [  7.21409000e+03,   3.04648244e+02,   0.0, 0.0],
#  [  8.38036000e+03,   2.99650957e+02,   0.0, 0.0],
#  [  9.25570000e+03,   2.96384905e+02,   0.0, 0.0],
#  [  1.04226400e+04,   2.97597801e+02,   0.0, 0.0],
#  [  1.12979300e+04,   2.98152179e+02,   0.0, 0.0],
#  [  1.15320000e+04,   2.98152179e+02,   0.0, 0.0],
#  [  1.18902400e+04,   2.98841966e+02,   0.0, 0.0],
#  [  1.27973000e+04,   2.99356526e+02,   0.0, 0.0],
#  [  1.37271800e+04,   2.99292602e+02,   0.0, 0.0],
#  [  1.50035000e+04,   2.98562063e+02,   0.0, 0.0],
#  [  1.63228300e+04,   2.96805638e+02,   0.0, 0.0],
#  [  1.67490000e+04,   2.96727136e+02,   0.0, 0.0],
#  [  1.87563400e+04,   2.94340057e+02,   0.0, 0.0],
#  [  2.06949000e+04,   2.93534851e+02,   0.0, 0.0],
#  [  2.19660000e+04,   2.93534851e+02,   0.0, 0.0],
#  [  2.39000200e+04,   2.90542342e+02,   0.0, 0.0],
#  [  2.66355600e+04,   2.90029354e+02,   0.0, 0.0],
#  [  2.71830000e+04,   2.90029354e+02,   0.0, 0.0],
#  [  3.13309600e+04,   2.96627600e+02,   0.0, 0.0],
#  [  3.24000000e+04,   2.96627600e+02,   0.0, 0.0]])
S = np.array([30000.0, 30000.0, 32400.0]) 
D = np.array([0.0, 0.0, 1098.0]) 

# z_profile = np.array([[    0.0, 330.0, 0.0, 0.0],
#                           [1150.0, 330.0, 0.0, 0.0],
#                           [3000.0, 330.0, 0.0, 0.0]])

z_profile = zInteg(S[2], D[2], z_profile)

f_time, frag_azimuth, frag_takeoff, frag_err = cyscan(S, D, z_profile, wind=True, \
                n_theta=1800, n_phi=1800, h_tol=1e-15, v_tol=330)


D = anglescan(S, frag_azimuth, frag_takeoff, z_profile, wind=True)

d_loc_err = np.sqrt(D[0]**2 + D[1]**2)
d_time_err = D[3] - f_time
d_err_err = d_loc_err - frag_err
print("Locational Error: ", d_loc_err)
print("Temporal Error: ", d_time_err)
print("Error Error: ", d_err_err)