
import numpy as np
import pyximport
pyximport.install(setup_args={'include_dirs':[np.get_include()]})
from supra.Supracenter.cyscan2 import cyscan
from supra.Supracenter.cyzInteg import zInteg


z_profile = np.array(
[[  1.09800000e+03,   3.33249621e+02,   6.39769967e+00,   8.15753052e-01],
 [  1.32870000e+03,   3.32245814e+02,   7.46880547e+00,   8.21841037e-01],
 [  1.45991000e+03,   3.31259057e+02,   7.75688260e+00,   8.19828570e-01],
 [  1.75063000e+03,   3.30386460e+02,   8.42901661e+00,   8.28831141e-01],
 [  2.08109000e+03,   3.29449692e+02,   8.86068035e+00,   8.06714981e-01],
 [  2.26180000e+03,   3.28453268e+02,   8.97530606e+00,   7.34630784e-01],
 [  2.65469000e+03,   3.27410620e+02,   9.00045710e+00,   6.62316170e-01],
 [  3.08925000e+03,   3.25090182e+02,   8.78484173e+00,   5.17458770e-01],
 [  3.81482000e+03,   3.22613843e+02,   9.23816624e+00,   4.71988932e-01],
 [  4.34173000e+03,   3.19867468e+02,   1.02598161e+01,   4.81650572e-01],
 [  4.89602000e+03,   3.16732426e+02,   1.13200487e+01,   4.82942404e-01],
 [  5.75930000e+03,   3.13210326e+02,   1.17077738e+01,   5.04343430e-01],
 [  6.31500000e+03,   3.13210326e+02,   1.17077738e+01,   5.04343430e-01],
 [  6.63166000e+03,   3.09223385e+02,   1.23709315e+01,   5.72768257e-01],
 [  7.21409000e+03,   3.04648244e+02,   1.19807062e+01,   5.62036780e-01],
 [  8.38036000e+03,   2.99650957e+02,   1.19626229e+01,   3.42363272e-01],
 [  9.25570000e+03,   2.96384905e+02,   1.34617191e+01,   4.15566865e-01],
 [  1.04226400e+04,   2.97597801e+02,   1.72666631e+01,   6.36915559e-01],
 [  1.12979300e+04,   2.98152179e+02,   1.85458983e+01,   8.13275332e-01],
 [  1.15320000e+04,   2.98152179e+02,   1.85458983e+01,   8.13275332e-01],
 [  1.18902400e+04,   2.98841966e+02,   1.63087678e+01,   9.13307592e-01],
 [  1.27973000e+04,   2.99356526e+02,   1.61640549e+01,   8.97905113e-01],
 [  1.37271800e+04,   2.99292602e+02,   1.68634748e+01,   9.74438712e-01],
 [  1.50035000e+04,   2.98562063e+02,   1.65094500e+01,   1.08703972e+00],
 [  1.63228300e+04,   2.96805638e+02,   1.48915123e+01,   1.39067664e+00],
 [  1.67490000e+04,   2.96727136e+02,   1.51893465e+01,   1.39105321e+00],
 [  1.87563400e+04,   2.94340057e+02,   1.16511671e+01,   1.33977629e+00],
 [  2.06949000e+04,   2.93534851e+02,   1.68547503e+01,   1.62653654e+00],
 [  2.19660000e+04,   2.93534851e+02,   1.68547503e+01,   1.62653654e+00],
 [  2.39000200e+04,   2.90542342e+02,   1.85821413e+01,   1.74761806e+00],
 [  2.66355600e+04,   2.90029354e+02,   3.13705767e+01,   1.47533555e+00],
 [  2.71830000e+04,   2.90029354e+02,   3.13705767e+01,   1.47533555e+00],
 [  3.13309600e+04,   2.96627600e+02,   4.80634166e+01,   1.57133120e+00],
 [  3.24000000e+04,   2.96627600e+02,   4.80634166e+01,   1.57133120e+00]]
)

          
s_plus_profile = np.array([[  1.09800000e+03,   3.33414341e+02,   7.34874605e+00,   7.18983497e-01],
                           [  1.32870000e+03,   3.32413535e+02,   7.85669502e+00,   7.40209973e-01],
                           [  1.45991000e+03,   3.31532684e+02,   8.22755021e+00,   7.53374009e-01],
                           [  1.75063000e+03,   3.30655778e+02,   8.50137075e+00,   7.38896314e-01],
                           [  2.08109000e+03,   3.29718512e+02,   8.43980541e+00,   7.20828179e-01],
                           [  2.26180000e+03,   3.28688737e+02,   8.43485137e+00,   6.85673499e-01],
                           [  2.65469000e+03,   3.27611289e+02,   8.44897999e+00,   6.61805707e-01],
                           [  3.08925000e+03,   3.25242408e+02,   8.56583858e+00,   6.32850931e-01],
                           [  3.81482000e+03,   3.22686037e+02,   9.09696592e+00,   6.00535530e-01],
                           [  4.34173000e+03,   3.19907778e+02,   9.87613005e+00,   5.60520837e-01],
                           [  4.89602000e+03,   3.16744245e+02,   1.07634300e+01,   5.21648009e-01],
                           [  5.11800000e+03,   3.16744245e+02,   1.07634300e+01,   5.21648009e-01],
                           [  5.75930000e+03,   3.13214310e+02,   1.16694092e+01,   4.81002731e-01],
                           [  6.63166000e+03,   3.09250288e+02,   1.22043338e+01,   4.49423109e-01],
                           [  7.21409000e+03,   3.04625031e+02,   1.23168210e+01,   4.61364460e-01],
                           [  8.38036000e+03,   2.99548217e+02,   1.17915601e+01,   3.46664143e-01],
                           [  9.13800000e+03,   2.99548217e+02,   1.17915601e+01,   3.46664143e-01],
                           [  9.25570000e+03,   2.96083012e+02,   1.34379355e+01,   3.77495195e-01],
                           [  1.04226400e+04,   2.97622959e+02,   1.66969052e+01,   6.45333806e-01],
                           [  1.12979300e+04,   2.97948422e+02,   1.74895958e+01,   7.85577046e-01],
                           [  1.18902400e+04,   2.98429679e+02,   1.71896426e+01,   8.83793326e-01],
                           [  1.27973000e+04,   2.99088231e+02,   1.66049015e+01,   8.91781217e-01],
                           [  1.31590000e+04,   2.98995717e+02,   1.69664698e+01,   8.70772178e-01],
                           [  1.37271800e+04,   2.99438496e+02,   1.77311992e+01,   9.69531822e-01],
                           [  1.50035000e+04,   2.98488214e+02,   1.70785639e+01,   1.04031943e+00],
                           [  1.63228300e+04,   2.96805638e+02,   1.53283646e+01,   1.41734129e+00],
                           [  1.71790000e+04,   2.96805638e+02,   1.53283646e+01,   1.41734129e+00],
                           [  1.87563400e+04,   2.94375385e+02,   1.32048014e+01,   1.27998616e+00],
                           [  2.06949000e+04,   2.93105166e+02,   1.62687238e+01,   1.59714633e+00],
                           [  2.12000000e+04,   2.93105166e+02,   1.62687238e+01,   1.59714633e+00],])   

s_minus_profile = np.array([[  1.09800000e+03,   3.33279576e+02,   7.26146300e+00,   7.27168124e-01],
                            [  1.32870000e+03,   3.32394764e+02,   8.31987114e+00,   6.91473328e-01],
                            [  1.45991000e+03,   3.31596665e+02,   9.03159161e+00,   6.91265359e-01],
                            [  1.75063000e+03,   3.30662067e+02,   9.73358273e+00,   6.86323046e-01],
                            [  2.08109000e+03,   3.29586022e+02,   9.94126403e+00,   7.04644231e-01],
                            [  2.26180000e+03,   3.28454534e+02,   1.00332511e+01,   7.40960971e-01],
                            [  2.65469000e+03,   3.27317864e+02,   1.00325381e+01,   7.67545197e-01],
                            [  3.08925000e+03,   3.25137520e+02,   1.00122299e+01,   7.63679108e-01],
                            [  3.81482000e+03,   3.22675725e+02,   9.91729101e+00,   7.29198481e-01],
                            [  3.96900000e+03,   3.22675725e+02,   9.91729101e+00,   7.29198481e-01],
                            [  4.34173000e+03,   3.19971483e+02,   1.03325017e+01,   6.37375917e-01],
                            [  4.89602000e+03,   3.16748185e+02,   1.10629441e+01,   4.97825665e-01],
                            [  5.75930000e+03,   3.13264772e+02,   1.15455334e+01,   4.18748843e-01],
                            [  6.63166000e+03,   3.09185718e+02,   1.12818545e+01,   3.80558161e-01],
                            [  6.84100000e+03,   3.09185718e+02,   1.12818545e+01,   3.80558161e-01],
                            [  7.21409000e+03,   3.04514408e+02,   1.07031149e+01,   3.76829183e-01],
                            [  8.38036000e+03,   2.99394040e+02,   1.20726967e+01,   3.29764652e-01],
                            [  9.25570000e+03,   2.96675274e+02,   1.39598782e+01,   3.96358309e-01],
                            [  9.71300000e+03,   2.96702612e+02,   1.42448542e+01,   3.83397120e-01],
                            [  1.04226400e+04,   2.97561458e+02,   1.80870141e+01,   5.50250975e-01],
                            [  1.12979300e+04,   2.97927480e+02,   1.84964423e+01,   7.36272469e-01],
                            [  1.18902400e+04,   2.98392044e+02,   1.70643089e+01,   8.55028975e-01],
                            [  1.25840000e+04,   2.98392044e+02,   1.70643089e+01,   8.55028975e-01],
                            [  1.27973000e+04,   2.98698566e+02,   1.69534305e+01,   9.05886191e-01],
                            [  1.37271800e+04,   2.99020076e+02,   1.81625923e+01,   9.05460399e-01],
                            [  1.50035000e+04,   2.98677677e+02,   1.72041825e+01,   1.05898209e+00],
                            [  1.54560000e+04,   2.98677677e+02,   1.72041825e+01,   1.05898209e+00],
                            [  1.63228300e+04,   2.96902322e+02,   1.47327761e+01,   1.34334157e+00],
                            [  1.83280000e+04,   2.96902322e+02,   1.47327761e+01,   1.34334157e+00],
                            [  1.87563400e+04,   2.94111031e+02,   1.20477741e+01,   1.42505935e+00],
                            [  2.06949000e+04,   2.93273995e+02,   1.64256915e+01,   1.54797803e+00],
                            [  2.12000000e+04,   2.93273995e+02,   1.64256915e+01,   1.54797803e+00],])
S = np.array([47508.85, 57435.25, 1098.0]) 
S_p = np.array([38006.21, 44247.86, 1098.0]) 
S_m = np.array([52810.12, 64792.14, 1098.0]) 
D = np.array([1069.86, -11475.30, 32400]) 

# S_profile = np.array([[    0.0, 330.0, 0.0, 0.0],
#                           [11500.0, 330.0, 0.0, 0.0],
#                           [100000.0, 330.0, 0.0, 0.0]])

z_profile = zInteg(S[2], D[2], z_profile)

f_time, frag_azimuth, frag_takeoff, frag_err = cyscan(D, S, z_profile, wind=True, \
                n_theta=4000, n_phi=4000, h_tol=1e-15, v_tol=330)

print(f_time, frag_azimuth, frag_takeoff, frag_err )